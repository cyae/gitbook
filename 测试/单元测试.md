<ul>
<li><strong>原则</strong>
<ul>
<li>Automatic</li>
<li>Isolation</li>
<li>Repeatable</li>
</ul>
</li>
<li><strong>注解</strong>
<ul>
<li>@Test
<ul>
<li>expected&mdash;&mdash;设置期望方法异常</li>
<li>timeout&mdash;&mdash;设置方法超时时间</li>
</ul>
</li>
<li>@BeforeClass&mdash;&mdash;用于创建资源连接</li>
<li>@Parameter&mdash;&mdash;用于指定输入变量和期望输出变量</li>
<li>@Before&mdash;&mdash;用于每个测试方法前初始化</li>
<li>@After&mdash;&mdash;用于每个测试方法后</li>
<li>@AfterClass&mdash;&mdash;用于释放资源</li>
<li>@Ignore&mdash;&mdash;忽略该测试方法</li>
<li>@RunWith(*.class)</li>
<li>@Rule&mdash;&mdash;设置全局超时时间或期望异常</li>
<li>@Parameters&mdash;&mdash;用于参数化测试时的数据集</li>
<li>@Suite.SuiteClasses(Test*.class...)&mdash;&mdash;用于整合同模块的测试类</li>
</ul>
</li>
<li><strong>参数化测试</strong>
<ul>
<li>1. @RunWith(Parameterized.class)修饰测试类</li>
<li>2. @Parameter修饰public 的输入/输出成员变量 或者 使用包含输入/输出成员变量的有参构造器</li>
<li>3. @Parameters修饰public static 的数据集生成方法</li>
<li>4. 在具体测试方法中使用，传入输入变量，assert输出变量与真实输出值</li>
</ul>
</li>
<li><strong>异常测试</strong>
<ul>
<li>assertThrows(Ex.class, 测试方法)</li>
<li>try-catch(assert...)</li>
<li>@Test(expected =Ex.class)</li>
<li>【推荐】@Rule public ExpectedException thrown = ExpectedException.none()
<ul>
<li>thrown.expect(Ex.class)</li>
</ul>
</li>
</ul>
</li>
<li><strong>Mockito</strong>
<ul>
<li>在做UT的时候，如果测试方法会引用很多外部依赖的对象，比如：<strong>远程数据库，网络通讯，远程服务, 文件系统，以及上述外部依赖的容器化部署</strong>，我们可能没法控制这些外部依赖：外部依赖的权限很高，或者外部依赖的启动成本很高，甚至外部依赖还未开发完成</li>
<li>用Mock工具来<strong>模拟这些外部依赖</strong>的对象，完成UT
<ul>
<li>本质上是使用拦截器隔离真实外部依赖</li>
</ul>
</li>
<li>常用注解
<ul>
<li>1. @RunWith(MockitoJUnitRunner.class) 或者 在@Before里initMocks(this)</li>
<li>2. @Mock修饰资源 或者 mock(资源.class)</li>
<li>3. when(资源调用)&mdash;thenReturn/thenThrow(模拟真实输出)
<ul>
<li>thenXXX可以链式调用，对应多次调用行为的响应</li>
<li>4. assert对比模拟值和期望值</li>
<li>对于无返回值的资源操作，verify可以匹配调用行为
<ul>
<li>匹配调用次数：verify(资源, freq).调用</li>
<li>freq可以是
<ul>
<li>times(n), 调用n次</li>
<li>never()，未调用</li>
<li>atLeast(n)，至少调用n次</li>
<li>atMost(n)，至多调用n次</li>
<li>匹配调用顺序：inorder.verify(资源).调用</li>
</ul>
</li>
</ul>
</li>
<li>使用参数匹配器anyXXX()可以忽略输入参数的具体值
<ul>
<li>实现ArgumentMatcher的match方法以自定义参数匹配器</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>对于构造器、私有方法、静态方法、单例，使用powerMock</li>
</ul>
</li>
<li><strong>常见问题</strong>
<ul>
<li>测试用例职责应该单一</li>
<li>测试异常Case断言推荐使用@Rule</li>
<li>测试异常Case不能只校验异常类型，同样要校验异常信息是否符合预期</li>
<li>断言不准确，仅断言retCode，无响应内容的校验，用例未必符合预期</li>
<li>用例没有执行业务方法，无效用例</li>
<li>UT仅测试正常流程，没有覆盖其他分支</li>
<li>无断言用例, 无Assert</li>
</ul>
</li>
</ul>
依赖真实环境，无法远程执行，执行效率低